from time import time
from typing import Tuple

import numpy


def decode_mask_rle_1(mask_string: str, shape: Tuple[int, int]) -> numpy.ndarray:
    """Decodes the mask array from the RLE-encoded form
    to the 2D numpy array.
    """
    values = []
    for kv in mask_string.split(' '):
        k_string, v_string = kv.split(':')
        k, v = int(k_string), int(v_string)
        vs = [k for _ in range(v)]
        values.extend(vs)

    mask = numpy.array(values).reshape(shape)
    return mask


def decode_mask_rle_2(mask_string: str, shape: Tuple[int, int]) -> numpy.ndarray:
    """Decodes the mask array from the RLE-encoded form
    to the 2D numpy array.
    """
    values = []
    for kv in mask_string.split(' '):
        k_string, v_string = kv.split(':')
        k, v = int(k_string), int(v_string)
        vs = [k] * v
        values.extend(vs)

    mask = numpy.array(values).reshape(shape)
    return mask


def decode_mask_rle_3(mask_string: str, shape: Tuple[int, int]) -> numpy.ndarray:
    """Decodes the mask array from the RLE-encoded form
    to the 2D numpy array.
    """
    mask_flat = numpy.zeros(shape[0] * shape[1], numpy.uint8)
    index = 0
    for kv in mask_string.split(' '):
        k_string, v_string = kv.split(':')
        k, v = int(k_string), int(v_string)
        if k == 1:
            mask_flat[index:index + v] = 1
        index += v

    mask = mask_flat.reshape(shape)
    return mask


test_string = "0:87 1:3 0:45 1:4 0:44 1:4 0:30 1:4 0:10 1:4 0:28 1:7 0:9 1:4 0:27 1:10 0:7 1:5 0:24 1:11 0:8 1:5 0:23 1:11 0:9 1:5 0:22 1:10 0:11 1:5 0:20 1:11 0:12 1:5 0:19 1:10 0:14 1:5 0:19 1:9 0:14 1:6 0:18 1:9 0:15 1:6 0:18 1:8 0:16 1:6 0:17 1:8 0:17 1:6 0:16 1:8 0:18 1:6 0:16 1:8 0:18 1:6 0:15 1:8 0:19 1:6 0:14 1:8 0:20 1:6 0:14 1:7 0:21 1:6 0:14 1:7 0:21 1:6 0:14 1:7 0:21 1:6 0:14 1:6 0:22 1:6 0:13 1:7 0:22 1:6 0:13 1:7 0:22 1:6 0:12 1:7 0:23 1:6 0:12 1:7 0:24 1:5 0:12 1:6 0:25 1:5 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:25 1:5 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:12 1:6 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:6 0:26 1:5 0:11 1:6 0:26 1:5 0:11 1:6 0:26 1:5 0:11 1:6 0:25 1:6 0:11 1:6 0:25 1:6 0:11 1:6 0:25 1:6 0:11 1:6 0:26 1:5 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:11 1:6 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:6 0:26 1:6 0:10 1:6 0:27 1:5 0:10 1:6 0:27 1:5 0:10 1:7 0:26 1:5 0:10 1:7 0:26 1:5 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:7 0:25 1:6 0:10 1:8 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:11 1:8 0:23 1:6 0:11 1:8 0:23 1:6 0:11 1:7 0:24 1:6 0:11 1:7 0:24 1:6 0:12 1:6 0:24 1:6 0:12 1:6 0:24 1:6 0:11 1:8 0:23 1:6 0:11 1:8 0:23 1:6 0:11 1:8 0:23 1:6 0:12 1:7 0:23 1:6 0:12 1:7 0:23 1:6 0:12 1:7 0:23 1:6 0:12 1:8 0:22 1:5 0:14 1:7 0:22 1:5 0:14 1:7 0:22 1:5 0:14 1:7 0:23 1:4 0:14 1:7 0:22 1:5 0:14 1:7 0:22 1:5 0:14 1:7 0:22 1:5 0:14 1:7 0:22 1:6 0:13 1:7 0:22 1:6 0:13 1:8 0:21 1:6 0:13 1:8 0:21 1:6 0:14 1:7 0:22 1:5 0:14 1:7 0:22 1:5 0:14 1:8 0:20 1:6 0:14 1:8 0:20 1:6 0:14 1:8 0:21 1:5 0:15 1:7 0:21 1:5 0:15 1:6 0:21 1:6 0:15 1:6 0:22 1:4 0:16 1:7 0:21 1:4 0:16 1:8 0:19 1:6 0:16 1:6 0:20 1:6 0:16 1:6 0:20 1:6 0:16 1:7 0:19 1:6 0:16 1:7 0:19 1:6 0:16 1:7 0:19 1:6 0:16 1:7 0:19 1:6 0:17 1:6 0:19 1:5 0:18 1:6 0:19 1:5 0:18 1:6 0:19 1:5 0:18 1:7 0:19 1:2 0:20 1:7 0:19 1:2 0:20 1:7 0:18 1:6 0:17 1:7 0:18 1:6 0:17 1:8 0:17 1:6 0:17 1:8 0:17 1:6 0:17 1:8 0:17 1:6 0:18 1:7 0:17 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:18 1:8 0:16 1:6 0:19 1:7 0:17 1:5 0:19 1:8 0:16 1:5 0:19 1:7 0:17 1:5 0:19 1:7 0:17 1:5 0:19 1:7 0:17 1:5 0:19 1:7 0:17 1:5 0:19 1:6 0:18 1:5 0:19 1:6 0:18 1:6 0:18 1:7 0:17 1:5 0:19 1:7 0:17 1:5 0:19 1:7 0:17 1:6 0:18 1:7 0:17 1:5 0:19 1:7 0:17 1:5 0:19 1:7 0:17 1:5 0:18 1:8 0:17 1:6 0:17 1:7 0:18 1:6 0:17 1:7 0:18 1:6 0:17 1:8 0:17 1:6 0:17 1:7 0:18 1:6 0:16 1:8 0:18 1:6 0:16 1:8 0:18 1:6 0:16 1:7 0:19 1:6 0:16 1:7 0:20 1:5 0:16 1:10 0:17 1:5 0:16 1:7 0:20 1:4 0:16 1:8 0:20 1:4 0:16 1:7 0:20 1:6 0:14 1:8 0:21 1:5 0:13 1:9 0:21 1:5 0:13 1:8 0:21 1:6 0:11 1:10 0:21 1:6 0:11 1:9 0:22 1:6 0:11 1:9 0:22 1:6 0:11 1:8 0:23 1:6 0:11 1:8 0:23 1:6 0:11 1:9 0:22 1:6 0:12 1:8 0:22 1:6 0:12 1:8 0:22 1:6 0:12 1:9 0:21 1:6 0:13 1:8 0:21 1:6 0:13 1:9 0:20 1:6 0:15 1:7 0:21 1:5 0:15 1:9 0:19 1:5 0:16 1:8 0:18 1:6 0:17 1:8 0:18 1:5 0:17 1:8 0:18 1:5 0:18 1:7 0:17 1:6 0:18 1:8 0:17 1:5 0:18 1:9 0:16 1:5 0:18 1:8 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:8 0:15 1:6 0:19 1:8 0:15 1:6 0:19 1:8 0:16 1:5 0:19 1:8 0:16 1:5 0:19 1:8 0:16 1:4 0:20 1:8 0:16 1:4 0:20 1:8 0:16 1:5 0:19 1:8 0:16 1:5 0:20 1:7 0:16 1:5 0:20 1:7 0:16 1:5 0:20 1:7 0:16 1:5 0:20 1:7 0:15 1:6 0:20 1:8 0:15 1:5 0:19 1:9 0:15 1:5 0:19 1:8 0:16 1:5 0:19 1:8 0:16 1:5 0:19 1:8 0:15 1:5 0:21 1:7 0:15 1:5 0:21 1:7 0:15 1:5 0:21 1:7 0:15 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:19 1:7 0:16 1:6 0:18 1:8 0:16 1:6 0:18 1:8 0:16 1:6 0:18 1:8 0:16 1:6 0:18 1:8 0:16 1:6 0:18 1:8 0:16 1:6 0:18 1:7 0:17 1:6 0:18 1:7 0:17 1:6 0:17 1:8 0:17 1:5 0:19 1:8 0:16 1:5 0:19 1:7 0:17 1:6 0:18 1:7 0:17 1:6 0:17 1:8 0:17 1:6 0:17 1:8 0:17 1:6 0:17 1:7 0:18 1:6 0:17 1:7 0:19 1:4 0:18 1:7 0:19 1:4 0:18 1:7 0:19 1:4 0:18 1:7 0:18 1:5 0:17 1:8 0:18 1:5 0:17 1:8 0:19 1:4 0:17 1:7 0:20 1:4 0:17 1:7 0:19 1:5 0:17 1:7 0:19 1:5 0:16 1:8 0:20 1:4 0:16 1:7 0:21 1:4 0:16 1:7 0:21 1:4 0:16 1:7 0:21 1:5 0:15 1:7 0:21 1:5 0:14 1:8 0:21 1:5 0:14 1:8 0:20 1:5 0:15 1:8 0:21 1:5 0:13 1:9 0:21 1:4 0:14 1:8 0:21 1:5 0:14 1:8 0:21 1:5 0:14 1:8 0:21 1:5 0:14 1:8 0:21 1:5 0:13 1:7 0:23 1:5 0:13 1:7 0:23 1:5 0:13 1:7 0:23 1:5 0:12 1:8 0:23 1:5 0:12 1:8 0:23 1:5 0:12 1:7 0:24 1:5 0:12 1:7 0:25 1:5 0:11 1:8 0:24 1:5 0:11 1:7 0:25 1:4 0:11 1:8 0:25 1:4 0:11 1:8 0:25 1:5 0:10 1:7 0:25 1:6 0:9 1:8 0:26 1:5 0:9 1:7 0:27 1:4 0:10 1:7 0:27 1:5 0:8 1:8 0:27 1:5 0:8 1:8 0:27 1:5 0:8 1:7 0:28 1:5 0:8 1:7 0:28 1:5 0:8 1:7 0:28 1:5 0:8 1:7 0:28 1:5 0:8 1:7 0:28 1:5 0:8 1:6 0:29 1:5 0:7 1:7 0:29 1:6 0:6 1:7 0:29 1:3 0:9 1:7 0:29 1:4 0:8 1:7 0:29 1:5 0:6 1:7 0:30 1:5 0:6 1:7 0:30 1:4 0:7 1:7 0:30 1:4 0:7 1:7 0:30 1:5 0:6 1:7 0:30 1:5 0:6 1:7 0:30 1:5 0:5 1:8 0:30 1:5 0:5 1:7 0:31 1:5 0:5 1:7 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:4 0:6 1:7 0:31 1:5 0:5 1:7 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:4 0:5 1:8 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:6 0:3 1:7 0:32 1:7 0:2 1:7 0:32 1:4 0:4 1:8 0:32 1:5 0:3 1:8 0:32 1:5 0:3 1:7 0:33 1:6 0:2 1:8 0:32 1:5 0:3 1:8 0:32 1:5 0:3 1:8 0:32 1:4 0:4 1:8 0:32 1:4 0:4 1:8 0:32 1:5 0:3 1:7 0:33 1:5 0:3 1:7 0:33 1:5 0:3 1:7 0:33 1:5 0:3 1:7 0:33 1:5 0:3 1:7 0:33 1:5 0:3 1:7 0:33 1:5 0:3 1:7 0:33 1:5 0:3 1:8 0:32 1:5 0:3 1:8 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:7 0:32 1:5 0:4 1:8 0:31 1:5 0:4 1:8 0:31 1:5 0:5 1:7 0:31 1:4 0:6 1:7 0:31 1:5 0:5 1:7 0:31 1:5 0:5 1:8 0:31 1:5 0:5 1:7 0:32 1:2 0:7 1:8 0:31 1:3 0:6 1:8 0:29 1:5 0:7 1:7 0:29 1:5 0:7 1:7 0:29 1:5 0:8 1:6 0:29 1:5 0:8 1:6 0:29 1:5 0:8 1:7 0:28 1:5 0:9 1:7 0:27 1:5 0:9 1:7 0:27 1:5 0:9 1:7 0:27 1:5 0:10 1:7 0:26 1:5 0:10 1:8 0:25 1:5 0:11 1:8 0:24 1:5 0:11 1:8 0:24 1:5 0:12 1:8 0:23 1:5 0:12 1:9 0:22 1:6 0:12 1:9 0:21 1:6 0:12 1:9 0:21 1:6 0:13 1:9 0:20 1:6 0:14 1:8 0:19 1:7 0:15 1:8 0:18 1:7 0:16 1:8 0:18 1:6 0:16 1:9 0:17 1:6 0:17 1:8 0:17 1:6 0:18 1:7 0:17 1:5 0:21 1:4 0:18 1:6 0:21 1:3 0:18 1:5 0:43 1:6 0:42 1:5 0:44 1:4 0:45 1:2 0:4"
shape = (353, 48)

mask1 = decode_mask_rle_1(test_string, shape)
mask2 = decode_mask_rle_2(test_string, shape)
mask3 = decode_mask_rle_3(test_string, shape)

assert numpy.array_equal(mask1, mask2)
assert numpy.array_equal(mask1, mask3)

start_time = time()
for i in range(10000):
    decode_mask_rle_1(test_string, shape)
end_time = time()
print("Duration (1): " + str(end_time - start_time))

start_time = time()
for i in range(10000):
    decode_mask_rle_2(test_string, shape)
end_time = time()
print("Duration (2): " + str(end_time - start_time))

start_time = time()
for i in range(10000):
    decode_mask_rle_3(test_string, shape)
end_time = time()
print("Duration (3): " + str(end_time - start_time))
